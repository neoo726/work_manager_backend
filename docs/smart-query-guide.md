# 智能查询使用指南

## 概述

智能查询功能允许用户使用自然语言查询工作事项，系统会自动解析查询意图并返回相关结果。

## 🧠 智能查询端点

### 接口信息
- **端点**: `POST /smart_query_work_items`
- **功能**: 支持自然语言查询，自动解析查询意图
- **优势**: 无需构造复杂的查询参数，直接使用自然语言

### 请求格式
```json
{
  "user_input": "用户的自然语言查询"
}
```

### 响应格式
```json
{
  "message": "查询成功",
  "error": false,
  "data": [
    {
      "id": "1",
      "type": "task",
      "summary": "任务摘要",
      "project_name": "项目名称",
      "due_date": "2025-07-27",
      "status": "in_progress",
      "priority": 2,
      "created_at": "2025-07-26 10:30:00",
      "updated_at": "2025-07-26 10:30:00"
    }
  ]
}
```

## 📝 支持的查询类型

### 1. 时间范围查询

#### 最近相关
- "最近有什么任务"
- "近期的工作安排"
- "这段时间的事项"

**时间范围**: 过去2周到未来2周（总共4周）

#### 具体时间
- "今天有什么安排"
- "明天的工作"
- "本周的会议"
- "下周的任务"

#### 过去时间
- "上周的工作"
- "过去一个月的任务"

### 2. 事项类型查询

#### 任务相关
- "有什么任务"
- "待办的工作"
- "需要做的事情"

#### 会议相关
- "今天有什么会议"
- "本周的会面安排"

#### 问题相关
- "有哪些问题需要解决"
- "当前的bug列表"

#### 想法相关
- "最近的创意想法"
- "有什么新点子"

### 3. 状态查询

#### 进行中
- "进行中的任务"
- "正在做的工作"
- "处理中的事项"

#### 已完成
- "已完成的工作"
- "做完的任务"

#### 待办
- "待办事项"
- "计划要做的"

### 4. 关键词查询

#### 项目相关
- "UMS相关的任务"
- "项目管理的工作"

#### 功能相关
- "批量操作的想法"
- "用户认证模块"

### 5. 组合查询

#### 时间+类型
- "本周的任务安排"
- "明天的会议"
- "最近的问题"

#### 时间+状态
- "今天要完成的工作"
- "本周进行中的任务"

#### 类型+状态
- "已完成的会议"
- "待办的任务"

## 🔍 查询解析逻辑

### 解析优先级
1. **时间范围识别** - 优先识别时间相关关键词
2. **事项类型识别** - 识别任务、会议等类型
3. **状态识别** - 识别待办、进行中等状态
4. **关键词提取** - 提取剩余的关键信息

### 智能匹配
- **模糊匹配**: 支持部分关键词匹配
- **同义词识别**: 理解不同的表达方式
- **上下文理解**: 结合多个条件进行查询

### 回退机制
- 如果无法解析特定条件，使用原始输入作为关键词搜索
- 确保即使解析失败也能返回相关结果

## 💡 使用技巧

### 1. 明确表达
- ✅ "最近有什么任务" 
- ❌ "有啥"

### 2. 组合查询
- ✅ "本周进行中的任务"
- ✅ "明天的会议安排"

### 3. 关键词查询
- ✅ "UMS相关的工作"
- ✅ "批量操作功能"

### 4. 时间表达
- ✅ "最近" (过去2周到未来2周)
- ✅ "今天"、"明天"、"本周"
- ✅ "上周"、"过去一个月"

## 🆚 与标准查询的对比

| 特性 | 智能查询 | 标准查询 |
|------|----------|----------|
| 输入方式 | 自然语言 | 结构化参数 |
| 学习成本 | 低 | 中等 |
| 查询精度 | 智能解析 | 精确匹配 |
| 适用场景 | 日常查询 | 复杂条件 |
| 容错性 | 高 | 低 |

## 🔧 在 Dify 中的使用

### 工作流配置
```
开始 → 知识库检索 → 代码执行 → HTTP请求(/smart_query_work_items) → 结束
```

### HTTP请求节点配置
- **URL**: `{{#代码执行.endpoint#}}`
- **方法**: POST
- **请求体**: 
```json
{
  "user_input": "{{#sys.query#}}"
}
```

### 知识库内容建议
在知识库中添加使用示例和说明，帮助用户更好地使用智能查询功能。

## 📊 性能和限制

### 性能特点
- **响应时间**: 通常 < 500ms
- **并发支持**: 支持多用户同时查询
- **缓存机制**: 暂无（可根据需要添加）

### 当前限制
- **语言支持**: 主要支持中文
- **查询复杂度**: 适合中等复杂度查询
- **历史记录**: 不保存查询历史

### 未来改进
- 支持更复杂的自然语言表达
- 添加查询历史和建议
- 支持多语言查询
- 增加查询缓存机制
