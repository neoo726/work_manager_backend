# 更新日志

## [1.0.0] - 2025-07-26 🎉

### 🚀 新增功能

#### 智能查询系统
- **新增智能查询端点** `/smart_query_work_items`
  - 支持自然语言输入查询
  - 自动解析查询意图和参数
  - 智能识别时间范围、事项类型、状态等

#### 增强的时间范围支持
- **扩展"最近"时间范围**：从过去2周到未来2周（总共4周）
- **混合时间查询逻辑**：结合创建时间、截止日期和开始日期
- **智能时间解析**：支持多种自然语言时间表达

#### 自然语言处理
- **新增文本解析器** `text_parser.py`
  - 识别时间相关关键词（最近、今天、明天、本周等）
  - 识别事项类型关键词（任务、会议、问题、想法等）
  - 识别状态关键词（待办、进行中、已完成等）
  - 智能提取查询关键词

### 🔧 功能改进

#### 查询逻辑优化
- **改进时间范围查询**：
  - "最近"类查询使用创建时间而非截止日期
  - "未来"类查询使用截止日期和开始日期
  - 支持跨越过去和未来的时间范围查询

#### 用户体验提升
- **增强调试日志**：详细记录查询参数和SQL执行
- **改进错误处理**：更友好的错误信息和异常处理
- **优化查询性能**：改进SQL查询逻辑

### 🐛 问题修复

#### 数据一致性
- **修复用户ID不一致问题**：
  - 统一所有记录的用户ID为 `dify_http_user`
  - 添加用户ID修复脚本 `fix_user_id.py`
  - 确保查询和记录使用相同的用户ID

#### 查询结果
- **修复"最近"查询返回空结果**：
  - 调整时间范围计算逻辑
  - 改进时间字段的查询条件
  - 确保查询能够正确匹配数据

### 🛠 开发工具

#### 新增测试和调试工具
- `test_smart_query.py` - 智能查询功能测试
- `test_date_range.py` - 时间范围计算测试
- `test_query_scenarios.py` - 各种查询场景测试
- `debug_data.py` - 数据库数据调试工具
- `fix_user_id.py` - 用户ID修复工具

### 📚 文档更新
- 更新 README.md 反映新功能
- 添加智能查询使用示例
- 完善 API 接口文档
- 新增开发和测试指南

### 🎨 用户体验优化
- **友好的响应消息**：移除技术细节，使用自然语言
- **简洁的反馈**：专注于用户关心的结果
- **一致的语言风格**：类似朋友间对话的自然表达

### 🔄 兼容性
- **向后兼容**：原有的 `/query_work_items` 接口保持不变
- **新接口**：`/smart_query_work_items` 作为增强功能提供
- **数据库**：无结构变更，仅数据修复

### 📋 完整功能列表
- ✅ 智能记录工作事项（任务、会议、问题、想法、笔记）
- ✅ 自然语言查询支持
- ✅ 扩展时间范围查询（过去2周到未来2周）
- ✅ 多条件组合查询
- ✅ 工作事项状态管理
- ✅ 用户数据隔离
- ✅ 完整的API文档
- ✅ Dify集成支持
- ✅ 开发调试工具

### 🚀 生产就绪
- **稳定性**：经过充分测试的核心功能
- **性能**：优化的查询逻辑和数据库操作
- **监控**：完整的日志和错误处理
- **文档**：详细的使用指南和API文档
